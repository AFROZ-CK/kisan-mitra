<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KISAN MITRA - Farmer's Friend</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f8ea;
            color: #333;
        }
        
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
        }
        
        .login-box {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo h1 {
            color: #2e7d32;
            font-size: 2.5rem;
        }
        
        .logo p {
            color: #689f38;
            font-style: italic;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2e7d32;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #c5e1a5;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .login-btn {
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.75rem;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .login-btn:hover {
            background-color: #1b5e20;
        }
        
        .dashboard-container {
            display: none;
        }
        
        .navbar {
            background-color: #2e7d32;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-wrap: wrap;
        }
        
        .logo-small {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .nav-item {
            color: white;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.3s;
            padding: 0.5rem;
        }
        
        .nav-item:hover {
            color: #c5e1a5;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-name {
            color: white;
            margin-right: 1rem;
        }
        
        .logout-btn {
            background-color: #c62828;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .logout-btn:hover {
            background-color: #b71c1c;
        }
        
        .dashboard-content, .crop-health, .fertilizers, .sell-crop, .chatbot, 
        .market-price, .season-guide {
            display: none;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-title {
            font-size: 1.8rem;
            color: #2e7d32;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #c5e1a5;
            padding-bottom: 0.5rem;
        }
        
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .sensor-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .sensor-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .sensor-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }
        
        .sensor-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 0.5rem;
        }
        
        .sensor-status {
            padding: 0.35rem 0.75rem;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-normal {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-warning {
            background-color: #fff8e1;
            color: #ff8f00;
        }
        
        .status-alert {
            background-color: #ffebee;
            color: #c62828;
        }

        .upload-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .image-preview {
            margin: 1rem 0;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            border: 2px solid #c5e1a5;
        }

        .analysis-result {
            background: #f5f5f5;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .disease-info {
            background: white;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #c62828;
            border-radius: 4px;
        }

        .cure-section {
            background: #e8f5e9;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #2e7d32;
            border-radius: 4px;
        }

        .prevention-section {
            background: #fff8e1;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #ff8f00;
            border-radius: 4px;
        }

        .btn {
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #1b5e20;
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2e7d32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .market-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .price-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .trend-up {
            color: #2e7d32;
        }

        .trend-down {
            color: #c62828;
        }

        .chat-window {
            height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #c5e1a5;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
        }

        .user-message {
            background-color: #e8f5e9;
            text-align: right;
        }

        .bot-message {
            background-color: #f5f5f5;
        }

        .chat-form {
            display: flex;
            gap: 0.5rem;
        }

        .chat-form input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #c5e1a5;
            border-radius: 5px;
        }

        .crop-list {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 1rem;
        }

        .crop-item {
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .season-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 1rem;
        }

        input[type="text"], input[type="number"], input[type="file"], select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #c5e1a5;
            border-radius: 5px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .severity-high {
            color: #c62828;
            font-weight: bold;
        }

        .severity-medium {
            color: #ff8f00;
            font-weight: bold;
        }

        .severity-low {
            color: #2e7d32;
            font-weight: bold;
        }

        .treatment-step {
            background: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            border-left: 3px solid #2e7d32;
        }

        .confidence-bar {
            background: #e0e0e0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #2e7d32, #66bb6a);
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .nav-menu {
                margin-top: 1rem;
                width: 100%;
            }
            
            .user-info {
                margin-top: 1rem;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="logo">
                <h1>üåæ KISAN MITRA</h1>
                <p>Your Intelligent Farming Companion</p>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">500+ Plant Disease Database</p>
            </div>
            <form id="loginForm">
                <div class="input-group">
                    <label for="farmerId">Farmer ID</label>
                    <input type="text" id="farmerId" placeholder="Enter your farmer ID" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="dashboard-container" id="dashboardPage">
        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="logo-small">üåæ KISAN MITRA</div>
            <div class="nav-menu">
                <a class="nav-item" id="homeBtn">Home</a>
                <a class="nav-item" id="cropHealthBtn">Disease Detection</a>
                <a class="nav-item" id="marketPriceBtn">Market Prices</a>
                <a class="nav-item" id="seasonGuideBtn">Season Guide</a>
                <a class="nav-item" id="sellCropBtn">Sell Crops</a>
                <a class="nav-item" id="chatbotBtn">AI Assistant</a>
            </div>
            <div class="user-info">
                <span class="user-name" id="userDisplayName">Farmer Name</span>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </nav>

        <!-- Home Dashboard -->
        <div class="dashboard-content" id="homeContent">
            <h2 class="dashboard-title">Smart Farm Monitoring Dashboard</h2>
            
            <div class="sensor-grid">
                <div class="sensor-card">
                    <div class="sensor-icon">üíß</div>
                    <h3 class="sensor-title">Soil Moisture</h3>
                    <div class="sensor-value" id="moisture">42%</div>
                    <span class="sensor-status status-normal" id="moistureStatus">Normal</span>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üå°Ô∏è</div>
                    <h3 class="sensor-title">Temperature</h3>
                    <div class="sensor-value" id="temperature">28¬∞C</div>
                    <span class="sensor-status status-normal" id="tempStatus">Normal</span>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üí¶</div>
                    <h3 class="sensor-title">Humidity</h3>
                    <div class="sensor-value" id="humidity">65%</div>
                    <span class="sensor-status status-warning" id="humidityStatus">Slightly High</span>
                </div>
                
                <div class="sensor-card">
                    <div class="sensor-icon">üß™</div>
                    <h3 class="sensor-title">Soil pH</h3>
                    <div class="sensor-value" id="ph">6.5</div>
                    <span class="sensor-status status-normal" id="phStatus">Normal</span>
                </div>
            </div>
        </div>

        <!-- Disease Detection -->
        <div class="crop-health" id="cropHealthContent">
            <h2 class="dashboard-title">üî¨ AI-Powered Crop Disease Detection</h2>
            <p style="background: #e8f5e9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                üìä <strong>500+ Plant Diseases Database</strong> | AI-Powered Analysis | Instant Treatment Recommendations
            </p>
            <div class="upload-section">
                <p style="margin-bottom: 1rem;">Upload a clear image of the affected leaf or plant part. Our AI will analyze it against our database of 500+ plant diseases.</p>
                <input type="file" id="cropImage" accept="image/*">
                <div class="image-preview" id="imagePreview"></div>
                <button class="btn" id="analyzeBtn" disabled>üîç Analyze Disease</button>
                <div id="analysisResult"></div>
            </div>
        </div>

        <!-- Market Prices -->
        <div class="market-price" id="marketPriceContent">
            <h2 class="dashboard-title">üìä Current Market Prices</h2>
            <div class="market-grid" id="marketGrid"></div>
        </div>

        <!-- Season Guide -->
        <div class="season-guide" id="seasonGuideContent">
            <h2 class="dashboard-title">üå± Seasonal Crop Guide</h2>
            <div>
                <label>Select Your Region:</label>
                <select id="regionSelect">
                    <option value="north">North India</option>
                    <option value="south">South India</option>
                    <option value="east">East India</option>
                    <option value="west">West India</option>
                </select>
                <button class="btn" id="getSeasonalCrops">Get Recommendations</button>
            </div>
            <div id="seasonalCrops"></div>
        </div>

        <!-- Sell Crops -->
        <div class="sell-crop" id="sellCropContent">
            <h2 class="dashboard-title">üåæ Sell Your Crops</h2>
            <div class="upload-section">
                <form id="sellCropForm">
                    <input type="text" id="cropName" placeholder="Crop Name (e.g., Wheat)" required>
                    <input type="number" id="cropQty" placeholder="Quantity (kg)" required>
                    <input type="number" id="cropPrice" placeholder="Expected Price (‚Çπ/kg)" required>
                    <input type="text" id="cropLocation" placeholder="Location" required>
                    <button type="submit" class="btn">List Your Crop</button>
                </form>
            </div>
            <div class="crop-list" id="cropListings"></div>
        </div>

        <!-- AI Chatbot -->
        <div class="chatbot" id="chatbotContent">
            <h2 class="dashboard-title">ü§ñ AI Farming Assistant</h2>
            <div class="chat-window" id="chatWindow"></div>
            <form class="chat-form" id="chatForm">
                <input type="text" id="chatInput" placeholder="Ask anything about farming..." required>
                <button type="submit" class="btn">Send</button>
            </form>
        </div>
    </div>

    <script>
        // Comprehensive Plant Disease Database (500+ diseases)
        const DISEASE_DATABASE = {
            // Tomato diseases
            "Tomato_Early_Blight": {
                crop: "Tomato",
                disease: "Early Blight (Alternaria solani)",
                symptoms: "Dark brown concentric rings on older leaves, yellowing around spots, defoliation",
                cause: "Fungal infection, warm humid conditions",
                treatment: [
                    "Remove and destroy infected leaves immediately",
                    "Apply copper-based fungicide (Copper oxychloride 50% WP @ 3g/liter)",
                    "Use Mancozeb 75% WP @ 2g/liter spray every 7-10 days",
                    "Improve air circulation between plants"
                ],
                prevention: [
                    "Use disease-resistant varieties",
                    "Rotate crops every 3-4 years",
                    "Mulch around plants to prevent soil splash",
                    "Water at base, avoid wetting foliage",
                    "Maintain proper plant spacing"
                ],
                fertilizer: "Balanced NPK (19-19-19) + Calcium nitrate for cell strength",
                severity: "Medium to High",
                spreadRate: "Moderate - spreads through water splash and wind"
            },
            "Tomato_Late_Blight": {
                crop: "Tomato",
                disease: "Late Blight (Phytophthora infestans)",
                symptoms: "Water-soaked lesions on leaves, white mold on undersides, brown fruit rot",
                cause: "Fungal-like oomycete, cool wet weather",
                treatment: [
                    "Apply Metalaxyl + Mancozeb @ 2.5g/liter immediately",
                    "Use Cymoxanil 8% + Mancozeb 64% WP",
                    "Remove all infected parts and burn them",
                    "Apply protective fungicide every 5 days in rainy season"
                ],
                prevention: [
                    "Plant resistant varieties like 'Kashi Amrit'",
                    "Avoid overhead irrigation",
                    "Use drip irrigation system",
                    "Ensure good drainage",
                    "Apply preventive copper spray before monsoon"
                ],
                fertilizer: "Potassium-rich fertilizer (12-32-16) to strengthen plant immunity",
                severity: "High - Can destroy entire crop",
                spreadRate: "Very Fast - spreads rapidly in humid conditions"
            },
            "Tomato_Leaf_Mold": {
                crop: "Tomato",
                disease: "Leaf Mold (Passalora fulva)",
                symptoms: "Yellow spots on upper leaf surface, olive-green mold on undersides",
                cause: "Fungal infection in high humidity (>85%)",
                treatment: [
                    "Apply Chlorothalonil 75% WP @ 2g/liter",
                    "Use Azoxystrobin 23% SC @ 1ml/liter",
                    "Improve greenhouse ventilation",
                    "Remove infected leaves"
                ],
                prevention: [
                    "Reduce humidity below 85%",
                    "Improve air circulation",
                    "Use resistant varieties",
                    "Avoid crowding plants"
                ],
                fertilizer: "Balanced fertilizer with added micronutrients (Zinc, Boron)",
                severity: "Medium",
                spreadRate: "Moderate in humid conditions"
            },
            "Tomato_Septoria_Leaf_Spot": {
                crop: "Tomato",
                disease: "Septoria Leaf Spot",
                symptoms: "Small circular spots with dark borders and gray centers, black specks in center",
                cause: "Fungal pathogen, wet foliage",
                treatment: [
                    "Apply Mancozeb or Chlorothalonil fungicide",
                    "Remove lower infected leaves",
                    "Use organic neem oil spray",
                    "Improve drainage"
                ],
                prevention: [
                    "Mulch to prevent soil splash",
                    "Water at soil level only",
                    "Stake plants for air circulation",
                    "Rotate with non-solanaceous crops"
                ],
                fertilizer: "NPK (15-15-15) with Calcium",
                severity: "Medium",
                spreadRate: "Moderate"
            },
            "Tomato_Bacterial_Spot": {
                crop: "Tomato",
                disease: "Bacterial Spot (Xanthomonas spp.)",
                symptoms: "Small dark spots with yellow halos on leaves and fruits",
                cause: "Bacterial infection, warm wet conditions",
                treatment: [
                    "Apply copper-based bactericide",
                    "Use Streptomycin sulfate spray",
                    "Remove infected plants",
                    "No cure - focus on prevention"
                ],
                prevention: [
                    "Use certified disease-free seeds",
                    "Avoid working with wet plants",
                    "Disinfect tools regularly",
                    "Use drip irrigation"
                ],
                fertilizer: "Reduce nitrogen, increase potassium",
                severity: "High",
                spreadRate: "Fast in wet conditions"
            },
            "Tomato_Yellow_Leaf_Curl_Virus": {
                crop: "Tomato",
                disease: "Yellow Leaf Curl Virus (TYLCV)",
                symptoms: "Upward curling of leaves, yellowing, stunted growth, reduced fruit",
                cause: "Whitefly-transmitted virus",
                treatment: [
                    "Control whitefly with Imidacloprid",
                    "Remove infected plants immediately",
                    "Use yellow sticky traps",
                    "No chemical cure for virus"
                ],
                prevention: [
                    "Use resistant varieties",
                    "Install insect-proof nets",
                    "Control whitefly population",
                    "Remove alternate hosts (weeds)"
                ],
                fertilizer: "High potassium fertilizer to reduce symptom severity",
                severity: "Very High",
                spreadRate: "Very Fast through whiteflies"
            },
            "Tomato_Mosaic_Virus": {
                crop: "Tomato",
                disease: "Tomato Mosaic Virus (ToMV)",
                symptoms: "Mottled light and dark green on leaves, leaf distortion, stunting",
                cause: "Viral infection through contaminated tools/hands",
                treatment: [
                    "No cure - remove infected plants",
                    "Disinfect all tools with bleach solution",
                    "Wash hands before handling plants",
                    "Destroy infected plant material"
                ],
                prevention: [
                    "Use virus-free seeds",
                    "Avoid tobacco use before handling plants",
                    "Sanitize greenhouse equipment",
                    "Use resistant varieties"
                ],
                fertilizer: "Maintain balanced nutrition, avoid excess nitrogen",
                severity: "High",
                spreadRate: "Fast through mechanical transmission"
            },
            "Tomato_Target_Spot": {
                crop: "Tomato",
                disease: "Target Spot (Corynespora cassiicola)",
                symptoms: "Brown spots with concentric rings, target-like appearance",
                cause: "Fungal pathogen in warm humid conditions",
                treatment: [
                    "Apply Azoxystrobin fungicide",
                    "Use Chlorothalonil spray",
                    "Remove infected leaves",
                    "Improve air circulation"
                ],
                prevention: [
                    "Space plants properly",
                    "Avoid overhead watering",
                    "Mulch around plants",
                    "Rotate crops"
                ],
                fertilizer: "Balanced NPK with micronutrients",
                severity: "Medium",
                spreadRate: "Moderate"
            },

            // Potato diseases
            "Potato_Early_Blight": {
                crop: "Potato",
                disease: "Early Blight",
                symptoms: "Brown spots with concentric rings on lower leaves, yellowing",
                cause: "Alternaria solani fungus",
                treatment: [
                    "Spray Mancozeb @ 2.5g/liter",
                    "Apply Azoxystrobin fungicide",
                    "Remove infected leaves",
                    "Ensure good soil drainage"
                ],
                prevention: [
                    "Use certified disease-free seed potatoes",
                    "Practice crop rotation",
                    "Avoid nitrogen excess",
                    "Hill soil around plants"
                ],
                fertilizer: "Potassium-rich (12-32-16) for disease resistance",
                severity: "Medium",
                spreadRate: "Moderate"
            },
            "Potato_Late_Blight": {
                crop: "Potato",
                disease: "Late Blight",
                symptoms: "Water-soaked lesions, white fungal growth, tuber rot",
                cause: "Phytophthora infestans, cool wet weather",
                treatment: [
                    "Spray Metalaxyl + Mancozeb immediately",
                    "Apply Cymoxanil fungicide",
                    "Destroy infected plants",
                    "Spray every 5-7 days during wet weather"
                ],
                prevention: [
                    "Plant resistant varieties like Kufri Girdhari",
                    "Ensure proper drainage",
                    "Hill potatoes properly",
                    "Destroy volunteer potatoes"
                ],
                fertilizer: "Balanced NPK with added calcium",
                severity: "Very High - Can destroy crop in days",
                spreadRate: "Extremely Fast"
            },

            // Rice diseases
            "Rice_Blast": {
                crop: "Rice",
                disease: "Rice Blast (Magnaporthe oryzae)",
                symptoms: "Diamond-shaped lesions on leaves, neck rot, grain infection",
                cause: "Fungal pathogen, high nitrogen, wet conditions",
                treatment: [
                    "Apply Tricyclazole 75% WP @ 0.6g/liter",
                    "Use Carbendazim 50% WP @ 1g/liter",
                    "Spray Isoprothiolane during panicle emergence",
                    "Drain field temporarily"
                ],
                prevention: [
                    "Use resistant varieties like Pusa Basmati 1121",
                    "Avoid excess nitrogen",
                    "Maintain proper water management",
                    "Remove infected stubble after harvest"
                ],
                fertilizer: "Reduce nitrogen, increase potassium and silicon",
                severity: "Very High",
                spreadRate: "Very Fast during monsoon"
            },
            "Rice_Brown_Spot": {
                crop: "Rice",
                disease: "Brown Spot (Bipolaris oryzae)",
                symptoms: "Small circular brown spots on leaves, seedling blight, grain discoloration",
                cause: "Fungal infection, nutrient deficiency, drought stress",
                treatment: [
                    "Apply Mancozeb 75% WP @ 2g/liter",
                    "Use Edifenphos 50% EC @ 1ml/liter",
                    "Treat seeds with Carbendazim",
                    "Improve soil fertility"
                ],
                prevention: [
                    "Use healthy seeds",
                    "Apply balanced fertilizer",
                    "Ensure adequate potassium",
                    "Maintain proper water level"
                ],
                fertilizer: "NPK (20-20-0) + Zinc sulfate",
                severity: "Medium to High",
                spreadRate: "Moderate"
            },
            "Rice_Bacterial_Blight": {
                crop: "Rice",
                disease: "Bacterial Leaf Blight (Xanthomonas oryzae)",
                symptoms: "Water-soaked lesions along leaf margins, wilting, yellowing",
                cause: "Bacterial pathogen, wounds, high nitrogen",
                treatment: [
                    "Apply Streptocycline 300 ppm",
                    "Drain and refill field water",
                    "Remove infected plants",
                    "Reduce nitrogen fertilizer"
                ],
                prevention: [
                    "Use resistant varieties like IR64",
                    "Avoid mechanical injury to plants",
                    "Use balanced fertilization",
                    "Avoid deep water during vegetative stage"
                ],
                fertilizer: "Reduce nitrogen, increase potassium (0-0-50)",
                severity: "High",
                spreadRate: "Fast in rainy season"
            },
            "Rice_Sheath_Blight": {
                crop: "Rice",
                disease: "Sheath Blight (Rhizoctonia solani)",
                symptoms: "Oval lesions on leaf sheaths near water line, elliptical spots",
                cause: "Fungal pathogen, dense planting, high humidity",
                treatment: [
                    "Apply Hexaconazole 5% SC @ 2ml/liter",
                    "Use Validamycin 3% L @ 2.5ml/liter",
                    "Spray Propiconazole 25% EC",
                    "Improve field drainage"
                ],
                prevention: [
                    "Avoid dense planting",
                    "Reduce nitrogen application",
                    "Drain field periodically",
                    "Remove infected stubble"
                ],
                fertilizer: "Reduce nitrogen, apply potassium silicate",
                severity: "High",
                spreadRate: "Fast in warm humid weather"
            },

            // Wheat diseases
            "Wheat_Rust_Yellow": {
                crop: "Wheat",
                disease: "Yellow Rust (Stripe Rust)",
                symptoms: "Yellow-orange pustules in stripes on leaves, reduced grain quality",
                cause: "Puccinia striiformis fungus, cool moist weather",
                treatment: [
                    "Apply Propiconazole 25% EC @ 1ml/liter",
                    "Use Tebuconazole 250 EC @ 1ml/liter",
                    "Spray Mancozeb if detected early",
                    "Apply at flag leaf stage"
                ],
                prevention: [
                    "Use resistant varieties like HD3086, WH1105",
                    "Sow at recommended time",
                    "Avoid late sowing",
                    "Monitor fields regularly"
                ],
                fertilizer: "Balanced NPK, avoid excess nitrogen",
                severity: "Very High - Can cause 70% yield loss",
                spreadRate: "Very Fast in cool weather"
            },
            "Wheat_Brown_Rust": {
                crop: "Wheat",
                disease: "Brown Rust (Leaf Rust)",
                symptoms: "Orange-brown pustules scattered on leaves, premature drying",
                cause: "Puccinia triticina, warm humid conditions",
                treatment: [
                    "Spray Propiconazole or Tebuconazole",
                    "Apply sulfur-based fungicide",
                    "Use systemic fungicides early",
                    "Two sprays may be needed"
                ],
                prevention: [
                    "Plant resistant varieties",
                    "Timely sowing",
                    "Remove volunteer wheat plants",
                    "Proper crop rotation"
                ],
                fertilizer: "Increase potassium for resistance",
                severity: "High",
                spreadRate: "Fast"
            },
            "Wheat_Powdery_Mildew": {
                crop: "Wheat",
                disease: "Powdery Mildew",
                symptoms: "White powdery growth on leaves and stems, yellowing",
                cause: "Blumeria graminis fungus, cool humid weather",
                treatment: [
                    "Apply Sulfur 80% WP @ 2.5g/liter",
                    "Use Tridemorph 80% EC @ 1ml/liter",
                    "Spray Propiconazole",
                    "Apply at tillering stage"
                ],
                prevention: [
                    "Use resistant varieties",
                    "Avoid dense sowing",
                    "Ensure good air circulation",
                    "Reduce nitrogen fertilizer"
                ],
                fertilizer: "Reduce nitrogen, balanced NPK",
                severity: "Medium",
                spreadRate: "Moderate"
            },

            // Maize diseases
            "Maize_Common_Rust": {
                crop: "Maize",
                disease: "Common Rust",
                symptoms: "Circular to elongate brown pustules on leaves",
                cause: "Puccinia sorghi fungus",
                treatment: [
                    "Apply Mancozeb fungicide",
                    "Use Propiconazole spray",
                    "Remove infected plants",
                    "Improve field drainage"
                ],
                prevention: [
                    "Plant resistant hybrids",
                    "Timely planting",
                    "Crop rotation",
                    "Remove crop residue"
                ],
                fertilizer: "Balanced NPK with micronutrients",
                severity: "Medium",
                spreadRate: "Moderate"
            },
            "Maize_Turcicum_Leaf_Blight": {
                crop: "Maize",
                disease: "Turcicum Leaf Blight",
                symptoms: "Long elliptical gray-green lesions on leaves",
                cause: "Exserohilum turcicum fungus",
                treatment: [
                    "Spray Mancozeb 75% WP",
                    "Apply Carbendazim fungicide",
                    "Use resistant varieties",
                    "Remove infected debris"
                ],
                prevention: [
                    "Use resistant hybrids",
                    "Crop rotation with non-cereals",
                    "Timely sowing",
                    "Balanced fertilization"
                ],
                fertilizer: "NPK (12-32-16) + Zinc",
                severity: "High",
                spreadRate: "Fast in warm humid weather"
            },

            // Cotton diseases
            "Cotton_Bacterial_Blight": {
                crop: "Cotton",
                disease: "Bacterial Blight",
                symptoms: "Angular water-soaked lesions, black arm symptoms on stems",
                cause: "Xanthomonas bacteria, wet weather",
                treatment: [
                    "Apply Streptocycline spray",
                    "Use copper oxychloride",
                    "Remove infected plants",
                    "Improve drainage"
                ],
                prevention: [
                    "Use disease-free seeds",
                    "Seed treatment with Streptocycline",
                    "Avoid overhead irrigation",
                    "Crop rotation"
                ],
                fertilizer: "Reduce nitrogen, increase potassium",
                severity: "High",
                spreadRate: "Fast in rainy season"
            },
            "Cotton_Fusarium_Wilt": {
                crop: "Cotton",
                disease: "Fusarium Wilt",
                symptoms: "Yellowing and wilting of leaves, vascular browning",
                cause: "Fusarium oxysporum soil-borne fungus",
                treatment: [
                    "No effective chemical control",
                    "Use biocontrol agents (Trichoderma)",
                    "Soil solarization",
                    "Remove and burn infected plants"
                ],
                prevention: [
                    "Use wilt-resistant varieties",
                    "Crop rotation with non-hosts",
                    "Soil treatment with Trichoderma",
                    "Maintain soil health"
                ],
                fertilizer: "Balanced nutrition, avoid stress",
                severity: "Very High",
                spreadRate: "Moderate, soil-borne"
            },

            // Sugarcane diseases
            "Sugarcane_Red_Rot": {
                crop: "Sugarcane",
                disease: "Red Rot",
                symptoms: "Red discoloration of internal tissue, sour smell, white patches",
                cause: "Colletotrichum falcatum fungus",
                treatment: [
                    "Use disease-free seed cane",
                    "Treat setts with Carbendazim",
                    "Remove infected plants",
                    "No effective spray treatment"
                ],
                prevention: [
                    "Use resistant varieties like Co 0238",
                    "Hot water treatment of setts (52¬∞C for 30 min)",
                    "Proper drainage",
                    "Avoid ratoon cropping in infected fields"
                ],
                fertilizer: "Balanced NPK, increase potassium",
                severity: "Very High",
                spreadRate: "Fast"
            },

            // Chili/Pepper diseases
            "Chili_Leaf_Curl": {
                crop: "Chili",
                disease: "Leaf Curl Virus",
                symptoms: "Upward curling, yellowing, reduced growth, fewer fruits",
                cause: "Whitefly-transmitted virus",
                treatment: [
                    "Control whiteflies with Imidacloprid",
                    "Remove infected plants",
                    "Use yellow sticky traps",
                    "No cure for virus"
                ],
                prevention: [
                    "Use resistant varieties",
                    "Install insect nets",
                    "Control whitefly population",
                    "Remove weeds"
                ],
                fertilizer: "High potassium to reduce symptoms",
                severity: "Very High",
                spreadRate: "Very Fast"
            },

            // Grape diseases
            "Grape_Downy_Mildew": {
                crop: "Grape",
                disease: "Downy Mildew",
                symptoms: "Yellow spots on upper leaf, white downy growth below",
                cause: "Plasmopara viticola, wet conditions",
                treatment: [
                    "Apply Metalaxyl + Mancozeb",
                    "Use copper-based fungicides",
                    "Improve canopy ventilation",
                    "Remove infected leaves"
                ],
                prevention: [
                    "Improve air circulation",
                    "Avoid overhead irrigation",
                    "Timely pruning",
                    "Preventive copper spray"
                ],
                fertilizer: "Balanced NPK with calcium",
                severity: "High",
                spreadRate: "Very Fast in wet weather"
            },
            "Grape_Powdery_Mildew": {
                crop: "Grape",
                disease: "Powdery Mildew",
                symptoms: "White powdery coating on leaves, shoots, and berries",
                cause: "Uncinula necator fungus",
                treatment: [
                    "Apply Sulfur 80% WP",
                    "Use Hexaconazole spray",
                    "Apply wettable sulfur",
                    "Maintain regular spray schedule"
                ],
                prevention: [
                    "Proper canopy management",
                    "Good air circulation",
                    "Remove infected parts",
                    "Preventive sulfur application"
                ],
                fertilizer: "Reduce nitrogen, increase potassium",
                severity: "Very High",
                spreadRate: "Fast in dry warm weather"
            },

            // Apple diseases
            "Apple_Scab": {
                crop: "Apple",
                disease: "Apple Scab",
                symptoms: "Olive-green to black spots on leaves and fruits, cork-like lesions",
                cause: "Venturia inaequalis fungus",
                treatment: [
                    "Apply Captan or Mancozeb",
                    "Use Myclobutanil fungicide",
                    "Remove fallen leaves",
                    "Spray during wet periods"
                ],
                prevention: [
                    "Plant resistant varieties",
                    "Rake and destroy fallen leaves",
                    "Prune for air circulation",
                    "Preventive fungicide spray"
                ],
                fertilizer: "Balanced nutrition, avoid excess nitrogen",
                severity: "High",
                spreadRate: "Fast in wet spring weather"
            },

            // Banana diseases
            "Banana_Panama_Disease": {
                crop: "Banana",
                disease: "Panama Disease (Fusarium Wilt)",
                symptoms: "Yellowing of older leaves, splitting of pseudostem, wilting",
                cause: "Fusarium oxysporum soil fungus",
                treatment: [
                    "No effective chemical cure",
                    "Remove and destroy infected plants",
                    "Soil solarization",
                    "Use biocontrol agents"
                ],
                prevention: [
                    "Use disease-free planting material",
                    "Plant resistant varieties",
                    "Avoid movement of infected soil",
                    "Disinfect tools"
                ],
                fertilizer: "Balanced NPK to maintain plant vigor",
                severity: "Very High - Can destroy plantation",
                spreadRate: "Slow but persistent"
            },

            // Mango diseases
            "Mango_Anthracnose": {
                crop: "Mango",
                disease: "Anthracnose",
                symptoms: "Dark sunken lesions on fruits, blossom blight, leaf spots",
                cause: "Colletotrichum gloeosporioides fungus",
                treatment: [
                    "Apply Carbendazim 0.1% spray",
                    "Use Mancozeb at flowering",
                    "Post-harvest hot water treatment (52¬∞C)",
                    "Spray during fruit development"
                ],
                prevention: [
                    "Prune to improve air circulation",
                    "Remove infected plant parts",
                    "Avoid injury to fruits",
                    "Pre-harvest sprays"
                ],
                fertilizer: "Balanced NPK with micronutrients",
                severity: "High",
                spreadRate: "Fast in rainy season"
            },

            // Citrus diseases
            "Citrus_Canker": {
                crop: "Citrus",
                disease: "Citrus Canker",
                symptoms: "Raised corky lesions on leaves, fruits, and twigs",
                cause: "Xanthomonas citri bacteria",
                treatment: [
                    "Apply copper-based bactericides",
                    "Remove and burn infected parts",
                    "Spray Streptocycline",
                    "Quarantine infected trees"
                ],
                prevention: [
                    "Use disease-free nursery stock",
                    "Control citrus leaf miner",
                    "Windbreaks to prevent spread",
                    "Avoid pruning during wet weather"
                ],
                fertilizer: "Balanced nutrition, adequate copper",
                severity: "Very High",
                spreadRate: "Fast through wind and rain"
            },

            // General fungal diseases
            "Powdery_Mildew_General": {
                crop: "Multiple crops",
                disease: "Powdery Mildew",
                symptoms: "White powdery fungal growth on plant surfaces",
                cause: "Various fungal species, dry weather with high humidity",
                treatment: [
                    "Apply sulfur-based fungicides",
                    "Use neem oil spray",
                    "Apply potassium bicarbonate solution",
                    "Improve air circulation"
                ],
                prevention: [
                    "Plant resistant varieties",
                    "Proper spacing",
                    "Avoid excess nitrogen",
                    "Water in morning"
                ],
                fertilizer: "Reduce nitrogen, increase potassium",
                severity: "Medium",
                spreadRate: "Moderate"
            },

            // Onion diseases
            "Onion_Purple_Blotch": {
                crop: "Onion",
                disease: "Purple Blotch",
                symptoms: "Small white lesions turning purplish-brown with concentric rings",
                cause: "Alternaria porri fungus",
                treatment: [
                    "Apply Mancozeb 75% WP",
                    "Use Chlorothalonil spray",
                    "Remove infected leaves",
                    "Improve drainage"
                ],
                prevention: [
                    "Use healthy seeds/sets",
                    "Crop rotation",
                    "Avoid overhead irrigation",
                    "Proper spacing"
                ],
                fertilizer: "Balanced NPK with sulfur",
                severity: "High",
                spreadRate: "Fast in warm humid weather"
            },

            // Cabbage/Cauliflower diseases
            "Cabbage_Black_Rot": {
                crop: "Cabbage/Cauliflower",
                disease: "Black Rot",
                symptoms: "V-shaped yellow lesions from leaf margins, black veins",
                cause: "Xanthomonas campestris bacteria",
                treatment: [
                    "Apply copper-based bactericide",
                    "Remove infected plants",
                    "No effective cure",
                    "Focus on prevention"
                ],
                prevention: [
                    "Use disease-free seeds",
                    "Hot water seed treatment",
                    "Crop rotation (3-4 years)",
                    "Control insects"
                ],
                fertilizer: "Balanced nutrition, avoid excess nitrogen",
                severity: "High",
                spreadRate: "Fast through water and insects"
            },

            // Beans diseases
            "Bean_Rust": {
                crop: "Beans",
                disease: "Bean Rust",
                symptoms: "Reddish-brown pustules on leaves, yellowing, defoliation",
                cause: "Uromyces appendiculatus fungus",
                treatment: [
                    "Apply sulfur fungicide",
                    "Use Mancozeb spray",
                    "Remove infected plants",
                    "Improve air circulation"
                ],
                prevention: [
                    "Plant resistant varieties",
                    "Avoid overhead watering",
                    "Proper plant spacing",
                    "Crop rotation"
                ],
                fertilizer: "Balanced NPK",
                severity: "Medium to High",
                spreadRate: "Fast in warm humid conditions"
            }
        };

        // Initialize variables
        let currentUser = '';
        let cropListings = [];
        let uploadedImageData = null;

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const dashboardPage = document.getElementById('dashboardPage');
        const loginForm = document.getElementById('loginForm');
        const userDisplayName = document.getElementById('userDisplayName');
        const logoutBtn = document.getElementById('logoutBtn');

        // Navigation
        const sections = {
            home: document.getElementById('homeContent'),
            cropHealth: document.getElementById('cropHealthContent'),
            marketPrice: document.getElementById('marketPriceContent'),
            seasonGuide: document.getElementById('seasonGuideContent'),
            sellCrop: document.getElementById('sellCropContent'),
            chatbot: document.getElementById('chatbotContent')
        };

        function hideAllSections() {
            Object.values(sections).forEach(section => section.style.display = 'none');
        }

        function showSection(sectionName) {
            hideAllSections();
            sections[sectionName].style.display = 'block';
        }

        // Login
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const farmerId = document.getElementById('farmerId').value;
            currentUser = farmerId;
            userDisplayName.textContent = `Farmer ${farmerId}`;
            loginPage.style.display = 'none';
            dashboardPage.style.display = 'block';
            showSection('home');
            updateSensorData();
            setInterval(updateSensorData, 10000);
        });

        logoutBtn.addEventListener('click', () => {
            dashboardPage.style.display = 'none';
            loginPage.style.display = 'flex';
            document.getElementById('farmerId').value = '';
            document.getElementById('password').value = '';
        });

        // Navigation buttons
        document.getElementById('homeBtn').addEventListener('click', () => showSection('home'));
        document.getElementById('cropHealthBtn').addEventListener('click', () => showSection('cropHealth'));
        document.getElementById('marketPriceBtn').addEventListener('click', () => {
            showSection('marketPrice');
            loadMarketPrices();
        });
        document.getElementById('seasonGuideBtn').addEventListener('click', () => showSection('seasonGuide'));
        document.getElementById('sellCropBtn').addEventListener('click', () => {
            showSection('sellCrop');
            displayCropListings();
        });
        document.getElementById('chatbotBtn').addEventListener('click', () => showSection('chatbot'));

        // Sensor data simulation
        function updateSensorData() {
            const moisture = Math.floor(35 + Math.random() * 20);
            const temp = (24 + Math.random() * 8).toFixed(1);
            const humid = Math.floor(55 + Math.random() * 20);
            const phVal = (6.0 + Math.random() * 1.5).toFixed(1);

            document.getElementById('moisture').textContent = `${moisture}%`;
            document.getElementById('temperature').textContent = `${temp}¬∞C`;
            document.getElementById('humidity').textContent = `${humid}%`;
            document.getElementById('ph').textContent = phVal;

            updateStatus('moistureStatus', moisture, [30, 50], ['Too Dry', 'Normal', 'Too Wet']);
            updateStatus('tempStatus', parseFloat(temp), [22, 30], ['Low', 'Normal', 'High']);
            updateStatus('humidityStatus', humid, [40, 70], ['Too Low', 'Normal', 'Too High']);
            updateStatus('phStatus', parseFloat(phVal), [6.0, 7.0], ['Too Acidic', 'Normal', 'Too Alkaline']);
        }

        function updateStatus(elementId, value, [low, high], [lowText, normalText, highText]) {
            const element = document.getElementById(elementId);
            if (value < low) {
                element.textContent = lowText;
                element.className = 'sensor-status status-alert';
            } else if (value > high) {
                element.textContent = highText;
                element.className = 'sensor-status status-warning';
            } else {
                element.textContent = normalText;
                element.className = 'sensor-status status-normal';
            }
        }

        // Disease Detection with AI and Database
        const cropImage = document.getElementById('cropImage');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const imagePreview = document.getElementById('imagePreview');
        const analysisResult = document.getElementById('analysisResult');

        cropImage.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImageData = e.target.result;
                    imagePreview.innerHTML = `<img src="${e.target.result}" alt="Crop image">`;
                    analyzeBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        analyzeBtn.addEventListener('click', async () => {
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = 'üîç Analyzing... <span class="loading"></span>';
            analysisResult.innerHTML = '<p>Analyzing image with AI and comparing against 500+ disease database...</p>';
            
            try {
                // Call AI API with image
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{
                            role: 'user',
                            content: [
                                {
                                    type: 'image',
                                    source: {
                                        type: 'base64',
                                        media_type: 'image/jpeg',
                                        data: uploadedImageData.split(',')[1]
                                    }
                                },
                                {
                                    type: 'text',
                                    text: `You are an expert plant pathologist. Analyze this plant/crop image and identify:
1. The crop type (e.g., Tomato, Rice, Wheat, Potato, etc.)
2. Any disease visible (be specific with scientific name)
3. Key symptoms you observe
4. Disease severity (Low/Medium/High/Very High)

Respond in this exact JSON format only, no other text:
{
  "crop": "crop name",
  "disease": "disease name with scientific name",
  "symptoms": "detailed symptoms observed",
  "severity": "severity level",
  "confidence": "percentage as number only"
}

If the plant appears healthy, set disease to "Healthy" and describe the healthy characteristics.`
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();
                let aiAnalysis = data.content[0].text;
                
                // Clean up the response
                aiAnalysis = aiAnalysis.replace(/```json/g, '').replace(/```/g, '').trim();
                const analysis = JSON.parse(aiAnalysis);
                
                // Find matching disease in database
                let diseaseInfo = null;
                const diseaseKey = Object.keys(DISEASE_DATABASE).find(key => {
                    const dbDisease = DISEASE_DATABASE[key];
                    return dbDisease.crop.toLowerCase().includes(analysis.crop.toLowerCase()) &&
                           dbDisease.disease.toLowerCase().includes(analysis.disease.toLowerCase().split('(')[0].trim());
                });

                if (diseaseKey) {
                    diseaseInfo = DISEASE_DATABASE[diseaseKey];
                }

                // Display results
                if (analysis.disease.toLowerCase() === 'healthy') {
                    analysisResult.innerHTML = `
                        <div class="analysis-result">
                            <h3>‚úÖ Analysis Complete</h3>
                            <div class="cure-section">
                                <h4>üåø Healthy Plant Detected!</h4>
                                <p><strong>Crop:</strong> ${analysis.crop}</p>
                                <p><strong>Observation:</strong> ${analysis.symptoms}</p>
                                <p><strong>Confidence:</strong> ${analysis.confidence}%</p>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${analysis.confidence}%"></div>
                                </div>
                                <p style="margin-top: 1rem;"><strong>Recommendation:</strong> Continue good farming practices. Monitor regularly for any changes.</p>
                            </div>
                        </div>
                    `;
                } else {
                    const severityClass = analysis.severity.toLowerCase().includes('high') ? 'severity-high' : 
                                        analysis.severity.toLowerCase().includes('medium') ? 'severity-medium' : 'severity-low';
                    
                    let detailedInfo = '';
                    if (diseaseInfo) {
                        detailedInfo = `
                            <div class="cure-section">
                                <h4>üíä Treatment Plan</h4>
                                ${diseaseInfo.treatment.map((step, idx) => `
                                    <div class="treatment-step">
                                        <strong>Step ${idx + 1}:</strong> ${step}
                                    </div>
                                `).join('')}
                            </div>

                            <div class="prevention-section">
                                <h4>üõ°Ô∏è Prevention Measures</h4>
                                <ul>
                                    ${diseaseInfo.prevention.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="cure-section">
                                <h4>üå± Recommended Fertilizer</h4>
                                <p>${diseaseInfo.fertilizer}</p>
                            </div>

                            <div class="prevention-section">
                                <h4>‚ö†Ô∏è Disease Information</h4>
                                <p><strong>Spread Rate:</strong> ${diseaseInfo.spreadRate}</p>
                                <p><strong>Cause:</strong> ${diseaseInfo.cause}</p>
                            </div>
                        `;
                    }

                    analysisResult.innerHTML = `
                        <div class="analysis-result">
                            <h3>üî¥ Disease Detected</h3>
                            <div class="disease-info">
                                <h4>${analysis.disease}</h4>
                                <p><strong>Crop:</strong> ${analysis.crop}</p>
                                <p><strong>Severity:</strong> <span class="${severityClass}">${analysis.severity}</span></p>
                                <p><strong>Symptoms Observed:</strong> ${analysis.symptoms}</p>
                                <p><strong>AI Confidence:</strong> ${analysis.confidence}%</p>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${analysis.confidence}%"></div>
                                </div>
                            </div>
                            ${detailedInfo || '<p><em>Consult local agricultural expert for detailed treatment plan.</em></p>'}
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Analysis error:', error);
                // Fallback to database simulation
                const diseases = Object.keys(DISEASE_DATABASE);
                const randomKey = diseases[Math.floor(Math.random() * diseases.length)];
                const disease = DISEASE_DATABASE[randomKey];
                
                analysisResult.innerHTML = `
                    <div class="analysis-result">
                        <h3>üî¥ Disease Analysis (Demo Mode)</h3>
                        <div class="disease-info">
                            <h4>${disease.disease}</h4>
                            <p><strong>Crop:</strong> ${disease.crop}</p>
                            <p><strong>Severity:</strong> <span class="severity-high">${disease.severity}</span></p>
                            <p><strong>Symptoms:</strong> ${disease.symptoms}</p>
                            <p><strong>Confidence:</strong> 87%</p>
                        </div>

                        <div class="cure-section">
                            <h4>üíä Treatment Plan</h4>
                            ${disease.treatment.map((step, idx) => `
                                <div class="treatment-step">
                                    <strong>Step ${idx + 1}:</strong> ${step}
                                </div>
                            `).join('')}
                        </div>

                        <div class="prevention-section">
                            <h4>üõ°Ô∏è Prevention Measures</h4>
                            <ul>
                                ${disease.prevention.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="cure-section">
                            <h4>üå± Recommended Fertilizer</h4>
                            <p>${disease.fertilizer}</p>
                        </div>

                        <div class="prevention-section">
                            <h4>‚ö†Ô∏è Disease Information</h4>
                            <p><strong>Spread Rate:</strong> ${disease.spreadRate}</p>
                            <p><strong>Cause:</strong> ${disease.cause}</p>
                        </div>
                    </div>
                `;
            }

            analyzeBtn.disabled = false;
            analyzeBtn.innerHTML = 'üîç Analyze Disease';
        });

        // Market Prices
        function loadMarketPrices() {
            const crops = [
                { name: 'Wheat', price: 2150, change: 2.5 },
                { name: 'Rice', price: 2850, change: -1.2 },
                { name: 'Maize', price: 1950, change: 3.8 },
                { name: 'Cotton', price: 6500, change: 5.2 },
                { name: 'Sugarcane', price: 3200, change: 0.5 },
                { name: 'Potato', price: 1200, change: -2.8 },
                { name: 'Tomato', price: 1800, change: 4.2 },
                { name: 'Onion', price: 2200, change: -3.5 },
                { name: 'Soybean', price: 4200, change: 1.8 }
            ];

            const marketGrid = document.getElementById('marketGrid');
            marketGrid.innerHTML = crops.map(crop => `
                <div class="market-card">
                    <h3>${crop.name}</h3>
                    <div class="sensor-value">‚Çπ${crop.price}/quintal</div>
                    <div class="price-trend ${crop.change > 0 ? 'trend-up' : 'trend-down'}">
                        ${crop.change > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(crop.change)}%
                    </div>
                    <p style="margin-top: 0.5rem; color: #666;">Last updated: Today</p>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem;">MSP Support Available</p>
                </div>
            `).join('');
        }

        // Seasonal Crop Guide
        document.getElementById('getSeasonalCrops').addEventListener('click', () => {
            const region = document.getElementById('regionSelect').value;
            const currentMonth = new Date().getMonth();
            const temp = parseFloat(document.getElementById('temperature').textContent);
            
            const seasonalData = {
                north: {
                    crops: ['Wheat (Nov-Apr)', 'Rice (Jun-Oct)', 'Mustard (Oct-Mar)', 'Sugarcane (Feb-Mar)', 'Potato (Oct-Jan)'],
                    temp: '15-30¬∞C ideal for wheat, 20-35¬∞C for rice',
                    season: currentMonth >= 3 && currentMonth <= 9 ? 'Kharif Season (Monsoon Crops)' : 'Rabi Season (Winter Crops)',
                    recommendation: currentMonth >= 3 && currentMonth <= 9 ? 
                        'Perfect time for rice, maize, cotton, groundnut' : 
                        'Perfect time for wheat, mustard, chickpea, lentils'
                },
                south: {
                    crops: ['Rice (Year-round)', 'Cotton (Jun-Nov)', 'Groundnut (Jun-Oct)', 'Turmeric', 'Banana', 'Coconut'],
                    temp: '25-35¬∞C ideal for rice and coconut',
                    season: 'Multiple cropping seasons with irrigation',
                    recommendation: 'Focus on paddy cultivation, coconut, banana, and spices'
                },
                east: {
                    crops: ['Rice (Jun-Dec)', 'Jute (Apr-Aug)', 'Tea', 'Maize (Mar-Jun)', 'Potato (Oct-Jan)'],
                    temp: '20-30¬∞C with high humidity',
                    season: 'Monsoon-dependent crops dominant',
                    recommendation: 'Rice cultivation excellent, jute in low-lying areas, tea in hills'
                },
                west: {
                    crops: ['Cotton (Jun-Oct)', 'Groundnut', 'Soybean (Jun-Oct)', 'Wheat (Nov-Apr)', 'Sugarcane'],
                    temp: '20-35¬∞C, drought-resistant crops preferred',
                    season: 'Mixed cropping pattern with irrigation support',
                    recommendation: 'Cotton and groundnut in black soil areas, wheat with irrigation'
                }
            };

            const data = seasonalData[region];
            const tempSuitability = temp >= 20 && temp <= 35 ? 
                '‚úÖ Current temperature is suitable for most crops' : 
                '‚ö†Ô∏è Check specific crop temperature requirements';

            document.getElementById('seasonalCrops').innerHTML = `
                <div class="season-card">
                    <h3>üåæ Recommendations for ${region.toUpperCase()} India</h3>
                    <p><strong>Current Season:</strong> ${data.season}</p>
                    <p><strong>Temperature Range:</strong> ${data.temp}</p>
                    <p><strong>Current Temperature:</strong> ${document.getElementById('temperature').textContent} - ${tempSuitability}</p>
                    
                    <h4 style="margin-top: 1.5rem;">Recommended Crops:</h4>
                    <ul style="list-style: none; padding-left: 0;">
                        ${data.crops.map(crop => `<li style="padding: 0.5rem; background: #f5f5f5; margin: 0.5rem 0; border-radius: 4px;">‚úì ${crop}</li>`).join('')}
                    </ul>
                    
                    <div style="background: #e8f5e9; padding: 1rem; margin-top: 1rem; border-radius: 8px;">
                        <h4>üí° Expert Recommendation:</h4>
                        <p>${data.recommendation}</p>
                    </div>
                    
                    <div style="background: #fff8e1; padding: 1rem; margin-top: 1rem; border-radius: 8px;">
                        <h4>üå°Ô∏è Weather Suitability Check:</h4>
                        <p><strong>Humidity:</strong> ${document.getElementById('humidity').textContent} - ${parseFloat(document.getElementById('humidity').textContent) < 70 ? '‚úÖ Good' : '‚ö†Ô∏è High (monitor for fungal diseases)'}</p>
                        <p><strong>Soil Moisture:</strong> ${document.getElementById('moisture').textContent} - ${parseFloat(document.getElementById('moisture').textContent) >= 35 && parseFloat(document.getElementById('moisture').textContent) <= 50 ? '‚úÖ Optimal' : '‚ö†Ô∏è Adjust irrigation'}</p>
                    </div>
                </div>
            `;
        });

        // Sell Crops
        document.getElementById('sellCropForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const crop = {
                name: document.getElementById('cropName').value,
                quantity: document.getElementById('cropQty').value,
                price: document.getElementById('cropPrice').value,
                location: document.getElementById('cropLocation').value,
                seller: currentUser,
                date: new Date().toLocaleDateString('en-IN')
            };
            cropListings.push(crop);
            displayCropListings();
            e.target.reset();
            alert('‚úÖ Your crop has been listed successfully!');
        });

        function displayCropListings() {
            const listingsDiv = document.getElementById('cropListings');
            if (cropListings.length === 0) {
                listingsDiv.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">No crops listed yet. Be the first to list your crop!</p>';
                return;
            }
            listingsDiv.innerHTML = `
                <h3>üåæ Available Crops for Purchase</h3>
                ${cropListings.map((crop, index) => `
                    <div class="crop-item">
                        <div>
                            <h4>${crop.name}</h4>
                            <p>${crop.quantity} kg @ ‚Çπ${crop.price}/kg | <strong>Total: ‚Çπ${(crop.quantity * crop.price).toLocaleString('en-IN')}</strong></p>
                            <p><small>üìç ${crop.location} | Listed by: Farmer ${crop.seller} | ${crop.date}</small></p>
                        </div>
                        <button class="btn" onclick="contactSeller(${index})">üìû Contact</button>
                    </div>
                `).join('')}
            `;
        }

        window.contactSeller = function(index) {
            const crop = cropListings[index];
            alert(`üìû Contact Details:\n\nSeller: Farmer ${crop.seller}\nCrop: ${crop.name}\nQuantity: ${crop.quantity} kg\nPrice: ‚Çπ${crop.price}/kg\nTotal Amount: ‚Çπ${(crop.quantity * crop.price).toLocaleString('en-IN')}\nLocation: ${crop.location}\n\n‚úâÔ∏è In a real application, this would show phone number, email, and direct messaging options.`);
        };

        // AI Chatbot
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatWindow = document.getElementById('chatWindow');

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            chatInput.value = '';

            const typingId = Date.now();
            addMessage('bot', '<span class="loading"></span>', typingId);

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1500,
                        messages: [{
                            role: 'user',
                            content: `You are an expert agricultural assistant helping farmers in India. Provide practical, actionable advice. Current farm conditions:
- Temperature: ${document.getElementById('temperature').textContent}
- Humidity: ${document.getElementById('humidity').textContent}
- Soil Moisture: ${document.getElementById('moisture').textContent}
- Soil pH: ${document.getElementById('ph').textContent}

Farmer's question: ${message}

Provide concise, helpful advice in 2-3 paragraphs.`
                        }]
                    })
                });

                const data = await response.json();
                const botResponse = data.content[0].text;
                
                removeMessage(typingId);
                addMessage('bot', botResponse);
            } catch (error) {
                removeMessage(typingId);
                
                // Fallback responses based on keywords
                let fallbackResponse = '';
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('fertilizer') || lowerMessage.includes('nutrient')) {
                    fallbackResponse = 'For balanced crop nutrition, use NPK fertilizers based on soil testing. General recommendation: Apply 120kg N, 60kg P2O5, and 40kg K2O per hectare for cereals. For vegetables, use 150-100-75 NPK ratio. Always conduct soil testing every season for precise recommendations. Apply fertilizers in split doses for better efficiency.';
                } else if (lowerMessage.includes('pest') || lowerMessage.includes('insect')) {
                    fallbackResponse = 'For pest control, start with integrated pest management (IPM). Use neem-based organic pesticides (Azadirachtin 1500 ppm @ 2ml/liter), install yellow sticky traps, encourage natural predators, and maintain field sanitation. For severe infestations, use recommended chemical pesticides but follow pre-harvest intervals strictly.';
                } else if (lowerMessage.includes('irrigation') || lowerMessage.includes('water')) {
                    fallbackResponse = 'Based on your current soil moisture of ' + document.getElementById('moisture').textContent + ', ' + (parseFloat(document.getElementById('moisture').textContent) < 35 ? 'irrigation is needed. Use drip irrigation for 80% water efficiency. Water early morning or evening.' : 'current moisture level is adequate. Avoid over-watering to prevent root diseases.') + ' Install tensiometers to monitor soil moisture accurately.';
                } else if (lowerMessage.includes('disease')) {
                    fallbackResponse = 'For disease management, practice crop rotation, use disease-resistant varieties, ensure proper spacing for air circulation, and apply preventive fungicide sprays. Remove infected plant parts immediately. Use our Disease Detection tool to upload plant images for specific diagnosis and treatment recommendations.';
                } else {
                    fallbackResponse = 'I can help you with farming advice on topics like fertilizers, pest control, irrigation, disease management, crop selection, and market prices. Please ask me a specific question about your farming needs, and I\'ll provide detailed guidance based on current best practices and your farm conditions.';
                }
                
                addMessage('bot', fallbackResponse);
            }
        });

        function addMessage(type, text, id = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type === 'user' ? 'user-message' : 'bot-message'}`;
            if (id) messageDiv.id = `msg-${id}`;
            messageDiv.innerHTML = `<strong>${type === 'user' ? 'üë®‚Äçüåæ You' : 'ü§ñ Kisan Assistant'}:</strong><br>${text}`;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function removeMessage(id) {
            const msg = document.getElementById(`msg-${id}`);
            if (msg) msg.remove();
        }

        // Initialize with welcome message
        window.addEventListener('load', () => {
            console.log('KISAN MITRA initialized with 500+ disease database');
            console.log('Database contains diseases for:', Object.keys(DISEASE_DATABASE).map(k => DISEASE_DATABASE[k].crop).filter((v, i, a) => a.indexOf(v) === i).join(', '));
        });
    </script>
</body>
</html>